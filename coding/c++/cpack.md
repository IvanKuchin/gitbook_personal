# CPack

## Base config

```cmake
set(CPACK_GENERATOR "DEB")
set(CPACK_SOURCE_GENERATOR TGZ)
set(CPACK_DEBIAN_PACKAGE_SHLIBDEPS ON)
set(CPACK_SET_DESTDIR "on")
set(CPACK_DEB_COMPONENT_INSTALL ON)
set(CPACK_PACKAGE_NAME "MyLib")
set(CPACK_PACKAGE_VENDOR "CMake.org")
set(CPACK_PACKAGE_DESCRIPTION_SUMMARY "MyLib - CPack Component Installation Example")
set(CPACK_PACKAGE_VERSION "1.0.0")
set(CPACK_PACKAGE_VERSION_MAJOR "1")
set(CPACK_PACKAGE_VERSION_MINOR "0")
set(CPACK_PACKAGE_VERSION_PATCH "0")
set(CPACK_PACKAGE_INSTALL_DIRECTORY "CPack Component Example")
set(CPACK_COMPONENTS_ALL applications libraries headers)
set(CPACK_COMPONENT_APPLICATIONS_GROUP "Runtime")
set(CPACK_COMPONENT_LIBRARIES_GROUP "Development")
set(CPACK_COMPONENT_HEADERS_GROUP "Development")
set(CPACK_COMPONENT_LIBRARIES_DEPENDS "libxml2")
set(CPACK_COMPONENT_HEADERS_DEPENDS "libxml2")

set(CPACK_DEBIAN_PACKAGE_DEPENDS "libusb-1.0-0")
set(CPACK_PACKAGE_CONTACT "Example ")
set(CPACK_PACKAGE_FILE_NAME "${CMAKE_PROJECT_NAME}_${VERSION}_${CPACK_DEBIAN_PACKAGE_ARCHITECTURE}")

include(CPack)
```

## Package type

CPack should be used to generate packages from sources.&#x20;

* .deb package generates by set`(CPACK_GENERATOR DEB)`
* .tar.gz package generated by `set(CPACK_SOURCE_GENERATOR TGZ)`

## Components

By default `make package` produces single package with all files inside.&#x20;

In case of requirements to produce more than one package&#x20;

* change CPack to component mode

```
set(CPACK_DEB_COMPONENT_INSTALL ON)
```

* it must be split to components. Every `INSTALL` instruction must be configured with `COMPONENT` keyword.&#x20;

```cmake
install(TARGETS baz COMPONENT baz DESTINATION bin)
install(TARGETS bar COMPONENT bar DESTINATION bin)
```

In this case two packages will be generated:

`<package_name>-<version>-<arch>-<component>.deb`&#x20;

## Static dependencies

```cmake
set(CPACK_COMPONENT_LIBRARIES_DEPENDS "libxml2")
set(CPACK_COMPONENT_HEADERS_DEPENDS "libusb")
```

## Dynamic dependencies

#### Test

Use `dpkg-shlibdeps` to see shared libs that ELF-file depends on.&#x20;

```
# dpkg-shlibdeps -O ./book.cgi
shlibs:Depends=libc6 (>= 2.14), libcurl4 (>= 7.16.2), libgcc-s1 (>= 3.0), libgraphicsmagick++-q16-12 (>= 1.3.26-5~), libmaxminddb0 (>= 1.0.2), libmysqlclient21 (>= 8.0.11), libssl1.1 (>= 1.1.0), libstdc++6 (>= 9)
```

{% hint style="warning" %}
If error `dpkg-shlibdeps: error: cannot read debian/control: No such file or directory`  will be thrown , create empty `debian/control` file.
{% endhint %}

{% hint style="warning" %}
Bug in Ubuntu 16.04: [https://bugs.launchpad.net/ubuntu/+source/cmake/+bug/1647868](https://bugs.launchpad.net/ubuntu/+source/cmake/+bug/1647868)

CPack/DEB shlibdep options depend on `file`utility and silently fails&#x20;
{% endhint %}

#### CMake dynamic dependencies

Add to `CMakeLists.txt`

```cmake
set(CPACK_DEBIAN_PACKAGE_SHLIBDEPS ON)
set(CPACK_DEBIAN_<COMPONENT>_PACKAGE_SHLIBDEPS ON)
```

